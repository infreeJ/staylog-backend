<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
								 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.staylog.staylog.domain.image.mapper.ImageMapper">

	<insert id="insertImage" parameterType="imageDto">
        <selectKey keyProperty="displayOrder" resultType="long" order="BEFORE">
            SELECT NVL(MAX(display_order), 0) + 1
            FROM image_file
            WHERE target_type = #{targetType} AND target_id = #{targetId}
        </selectKey>
		INSERT INTO image_file (
			image_type, target_type, target_id,
			saved_name, original_name, file_size,
			mime_type, display_order, upload_date
		)
		VALUES (
			#{imageType}, #{targetType}, #{targetId},
			#{savedName}, #{originalName}, #{fileSize},
			#{mimeType}, #{displayOrder}, SYSDATE
		)
	</insert>
	
	<select id="selectImageByTarget">
		
	</select>
</mapper>