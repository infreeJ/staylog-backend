# 🏡 StayLog (Backend)
> **커뮤니티 기반 숙소 예약 서비스**
>
> *사용자 경험을 위한 실시간 알림 서비스와 대용량 트래픽을 고려한 조회 성능 최적화에 집중했습니다.*

## 프로젝트 개요
**StayLog**는 숙소 예약 기능에 커뮤니티 요소를 결합한 웹 서비스입니다.
단순한 기능 구현을 넘어, **실제 서비스 운영 시 발생할 수 있는 대용량 트래픽과 데이터 정합성 문제**를 해결하는 데 집중했습니다.

* **프로젝트 기간:** 2025.10.13 ~ 2025.11.12 (4주)
* **팀 구성:** 총 9명 (Backend & Frontend 풀스택 협업)
* **Frontend Repository:** https://github.com/infreeJ/staylog-frontend
* **Service URL:** https://staylog.store/

### 내가 기여한 부분
* **실시간 알림 시스템 구축:** SSE 도입 및 반정규화를 통한 조회 성능 90% 개선 (1,200 TPS 달성)
* **할인 쿠폰 구현:** 비동기 이벤트 기반으로 자원 낭비 방지 및 서버 문제 발생 시 재시도 로직 구현
* **이메일 인증 회원가입 구현:** Gmail을 통한 이메일 인증 및 3차례에 걸친 유효성 검증으로 안정성 및 정합성 확보

---

## 🛠️ 사용 기술

| Category | Tech | Reason for Selection |
| :-- | :-- | :-- |
| **Language** | Java 17 | 최신 LTS 버전의 향상된 JVM 성능 및 라이브러리 호환성 확보 |
| **Framework** | Spring Boot | 안정적인 생태계를 활용한 생산성 증대 |
| **Database** | Oracle 11c | 결제/예약 도메인의 복잡한 트랜잭션 관리와 데이터 무결성 보장 |
| **Mapper** | MyBatis | 복잡한 통계/동적 쿼리에 대한 세밀한 제어권 확보 및 튜닝 용이성 |
| **DevOps** | AWS & Docker | 일관된 배포 환경 구축 및 리소스 관리 효율화 |
| **CI/CD** | Github Actions | 빌드/테스트/배포 자동화를 통한 개발 주기 단축 |

---

## 트러블슈팅

### 🔔 실시간 알림 조회 성능 1,200 TPS로 개선

#### 문제 상황
초기 Polling 방식의 알림 시스템에서 불필요한 HTTP 요청으로 **4~5초간 페이지 프리징** 현상이 발생했습니다. 이를 해결하기 위해 SSE(Server-Sent Events)를 도입했으나, 알림 데이터 조회를 위해 수많은 테이블을 JOIN 하는 과정에서 발생한 **메가 쿼리**로 인해 DB 부하가 여전히 심각했습니다.

#### 해결 과정
성능 최적화를 위해 **조회 속도**에 집중한 설계를 적용했습니다.

1.  **조회 성능 최적화:**
    * 이벤트별로 상이한 알림 세부 데이터를 `JSON` 문자열로 변환하여 단일 컬럼에 저장했습니다.
    * **결과:** 복잡했던 JOIN 연산을 **0회**로 줄이고, 단순 `SELECT`만으로 조회 가능하도록 튜닝했습니다.
2.  **커서 기반 페이징:**
    * 데이터가 쌓일수록 느려지는 Offset 방식 대신, `lastId`와 `lastCreatedAt`을 활용한 No-Offset 방식을 도입했습니다.
    * 데이터 양과 무관하게 일정한 조회 속도를 보장했습니다.
3.  **트랜잭션 분리 및 비동기 처리:**
    * `@TransactionalEventListener`와 `AfterCommit`을 사용하여 핵심 비즈니스 로직(예약 등)과 부가 기능(알림)의 트랜잭션을 분리했습니다.
    * 알림 저장 실패가 예약 로직에 영향을 주지 않도록 격리하고, `@Retryable`을 적용하여 일시적 DB 오류에 대한 장애 내성을 확보했습니다.

#### 결과 (JMeter Test)
* **Test Scenario:** VUsers 500명 동시 접속
* **Before:** Avg Latency 4,000ms+
* **After:** **Avg Latency 355ms** / **Throughput 1,200+ TPS**
* **Impact:** 조회 속도 약 **90% 단축** 및 안정적인 실시간 서비스 구현

---
